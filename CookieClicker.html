<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0" />
    <title>Cookie Clicker</title>
    <link rel="stylesheet" href="Styles/style.css">
    <style>
        /* Base page styling */
        body {
            text-align: center;
            margin: 0;
            padding: 0 16px 60px;
            color: #000;
        }

        /* Simple nav */
        nav ul {
            list-style: none;
            display: flex;
            gap: 16px;
            padding: 12px 16px;
            margin: 16px auto 0;
            background: #e5e5e5;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        nav a {
            color: #000000;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 6px;
        }

        nav a:hover {
            background: #d4d4d4;
        }

        main {
            margin-top: 24px;
        }

        h2 {
            font-size: 32px;
            color: inherit;
            margin: 12px 0 8px;
        }

        #score {
            font-size: 28px;
            font-weight: bold;
            margin: 8px 0 12px;
            color: inherit;
        }

        #stats {
            color: inherit;
            font-weight: bold;
            margin-bottom: 18px;
        }

        /* Cookie styling */
        #cookie {
            width: 200px;
            height: 200px;
            background-color: #d2691e;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
            user-select: none;
            overflow: visible;
        }

        #cookie:active {
            transform: scale(0.92);
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
        }

        .chocolate-chip {
            width: 18px;
            height: 18px;
            background-color: #4b2e1f;
            border-radius: 50%;
            position: absolute;
            z-index: 1;
        }

        #cursor-orbits {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 2;
        }

        .cursor-orbit {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            transform: rotate(var(--start-angle));
        }

        .cursor-spin {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            animation: orbit-spin 6s linear infinite;
        }

        .cursor-triangle {
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 12px solid var(--accent);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }

        @keyframes orbit-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Chip positions */
        .chip1 { top: 30px; left: 60px; }
        .chip2 { top: 70px; right: 50px; }
        .chip3 { bottom: 40px; left: 80px; }
        .chip4 { top: 100px; left: 110px; }
        .chip5 { bottom: 30px; right: 60px; }
        .chip6 { top: 40px; right: 80px; }
        .chip7 { bottom: 80px; left: 40px; }

        /* Buttons */
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 16px;
            transition: background-color 0.3s, opacity 0.2s;
        }

        button:hover {
            background-color: #038c59;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Shop / upgrades */
        .layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            max-width: 920px;
            margin: 0 auto;
        }

        @media (min-width: 880px) {
            .layout {
                grid-template-columns: 360px 1fr;
                align-items: start;
            }
        }

        .panel {
            background: var(--card);
            color: #111111;
            border: 1px solid #dfe6f2;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 6px 18px rgba(15, 30, 50, 0.06);
        }

        .panel h3 {
            margin: 0 0 12px;
            color: inherit;
        }

        #shop .upgrade {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px 12px;
            align-items: center;
            border: 1px solid #dfe6f2;
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 10px;
            background: #f7f9fc;
        }

        .upgrade-title {
            font-weight: bold;
            color: #111111;
        }

        .upgrade-desc {
            color: var(--muted);
            font-size: 13px;
        }

        .upgrade-meta {
            color: #111111;
            font-size: 13px;
        }

        .upgrade-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-end;
        }

        .inline {
            display: inline-block;
            min-width: 64px;
            text-align: right;
        }

        .muted {
            color: var(--muted);
            font-size: 13px;
        }
    </style>
</head>

<body>
    <nav>
        <ul>
            <li><a href="Home.html">Home</a></li>
            <li><a href="CookieClicker.html">Cookie Clicker</a></li>
            <li><a href="WhoAmI.html">Who Am I</a></li>
            <li><a href="Hobbies.html">Hobbies</a></li>
            <li><a href="ChatBot.html">Chat Bot</a></li>
        </ul>
    </nav>
    <div class="theme-controls">
        <button class="theme-toggle" type="button" id="themeToggle">Dark Mode</button>
    </div>

    <main>
        <h1>Cookie Clicker</h1>
        <p>Score: <span id="score">0</span></p>
        <div id="stats">
            CPC: <span id="cpc">1</span> | CPS: <span id="cps">0</span>
        </div>

        <div class="layout">
            <div class="panel">
                <div id="cookie" title="Click me!">
                    <div id="cursor-orbits" aria-hidden="true"></div>
                    <div class="chocolate-chip chip1"></div>
                    <div class="chocolate-chip chip2"></div>
                    <div class="chocolate-chip chip3"></div>
                    <div class="chocolate-chip chip4"></div>
                    <div class="chocolate-chip chip5"></div>
                    <div class="chocolate-chip chip6"></div>
                    <div class="chocolate-chip chip7"></div>
                </div>
                <br />
                <button id="reset-button">Reset Progress</button>
            </div>

            <div class="panel">
                <h3>Upgrades</h3>
                <div id="shop"></div>
                <div class="muted">Costs rise with each purchase. Progress saves automatically.</div>
            </div>
        </div>
    </main>

    <script>
        (() => {
            const root = document.documentElement;
            const stored = localStorage.getItem("theme");
            if (stored === "light" || stored === "dark") {
                root.setAttribute("data-theme", stored);
            }
            const button = document.getElementById("themeToggle");
            if (button) {
                const setLabel = () => {
                    const isDark = root.getAttribute("data-theme") === "dark";
                    button.textContent = isDark ? "Light Mode" : "Dark Mode";
                };
                setLabel();
                button.addEventListener("click", () => {
                    const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
                    root.setAttribute("data-theme", next);
                    localStorage.setItem("theme", next);
                    setLabel();
                });
            }
        })();
    </script>

    <script>

        const SAVE_KEY = 'cookieGame.save';

        const DEFAULT_UPGRADES = [
            { id: 'cursor', name: 'Cursor', baseCost: 15, costMultiplier: 1.15, cps: 0.1, cpc: 0, count: 0, description: 'A helpful cursor that adds 0.1 CPS.' },
            { id: 'grandma', name: 'Grandma', baseCost: 100, costMultiplier: 1.15, cps: 1, cpc: 0, count: 0, description: 'A loving grandma that bakes 1 CPS.' },
            { id: 'farm', name: 'Farm', baseCost: 1100, costMultiplier: 1.15, cps: 8, cpc: 0, count: 0, description: 'Fresh cookie crops: 8 CPS.' },
            { id: 'mine', name: 'Mine', baseCost: 12000, costMultiplier: 1.15, cps: 47, cpc: 0, count: 0, description: 'Deep cookie veins: 47 CPS.' },
            { id: 'click', name: 'Click Power', baseCost: 50, costMultiplier: 1.25, cps: 0, cpc: 1, count: 0, description: 'Each level adds +1 cookies per click.' }
        ];

        function newState() {
            return {
                cookies: 0,
                cpc: 1,
                upgrades: DEFAULT_UPGRADES.map(u => ({ ...u, count: 0 })),
                lastSave: Date.now()
            };
        }

        // ====== DOM ======
        const cookieEl = document.getElementById('cookie');
        const scoreEl = document.getElementById('score');
        const cpcEl = document.getElementById('cpc');
        const cpsEl = document.getElementById('cps');
        const resetButton = document.getElementById('reset-button');
        const shopEl = document.getElementById('shop');
        const cursorOrbitsEl = document.getElementById('cursor-orbits');

        // ====== Helpers ======
        const UNITS = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
        function formatNumber(value) {
            const abs = Math.abs(value);
            if (abs < 1000) {
                // Show up to 2 decimals for small numbers
                return (Math.round(value * 100) / 100).toString();
            }
            let unit = 0;
            let num = value;
            while (Math.abs(num) >= 1000 && unit < UNITS.length - 1) {
                num /= 1000;
                unit++;
            }
            const precision = Math.abs(num) < 10 ? 2 : (Math.abs(num) < 100 ? 1 : 0);
            return num.toFixed(precision) + UNITS[unit];
        }

        function costFor(upgrade) {
            // Typical incremental game scaling
            return Math.ceil(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.count));
        }

        function totalCPS(state) {
            return state.upgrades.reduce((sum, u) => sum + (u.cps * u.count), 0);
        }

        function recomputeCPC(state) {
            // Base CPC is 1, plus any click-power upgrades
            const extra = state.upgrades.reduce((sum, u) => sum + (u.cpc * u.count), 0);
            state.cpc = 1 + extra;
        }

        // ====== Save / Load ======
        function serialize(state) {
            const counts = {};
            state.upgrades.forEach(u => counts[u.id] = u.count);
            return {
                cookies: state.cookies,
                upgrades: counts,
                lastSave: state.lastSave
            };
        }

        function save(state) {
            state.lastSave = Date.now();
            try {
                localStorage.setItem(SAVE_KEY, JSON.stringify(serialize(state)));
            } catch (e) {
                console.warn('Save failed:', e);
            }
        }

        function load() {
            const raw = localStorage.getItem(SAVE_KEY);
            if (!raw) return newState();
            try {
                const data = JSON.parse(raw);
                const state = newState();
                state.cookies = typeof data.cookies === 'number' ? data.cookies : 0;

                // Rebuild upgrades from defaults to keep definitions in sync
                const savedCounts = data.upgrades || {};
                state.upgrades = DEFAULT_UPGRADES.map(def => ({
                    ...def,
                    count: typeof savedCounts[def.id] === 'number' ? savedCounts[def.id] : 0
                }));

                // Recompute CPC from upgrades
                recomputeCPC(state);

                // Offline progress
                const then = typeof data.lastSave === 'number' ? data.lastSave : Date.now();
                const seconds = Math.max(0, (Date.now() - then) / 1000);
                const cps = totalCPS(state);
                const offlineEarned = cps * seconds;

                if (offlineEarned > 0) {
                    state.cookies += offlineEarned;
                }
                state.lastSave = Date.now();
                return state;
            } catch (e) {
                console.warn('Load failed, starting fresh:', e);
                return newState();
            }
        }

        // ====== UI ======
        function buildShop(state) {
            shopEl.innerHTML = '';
            state.upgrades.forEach(upg => {
                const container = document.createElement('div');
                container.className = 'upgrade';
                container.id = `upgrade-${upg.id}`;

                const left = document.createElement('div');
                const title = document.createElement('div');
                title.className = 'upgrade-title';
                title.textContent = upg.name;

                const desc = document.createElement('div');
                desc.className = 'upgrade-desc';
                desc.textContent = upg.description;

                const meta = document.createElement('div');
                meta.className = 'upgrade-meta';
                meta.innerHTML = `
                    <span>Owned: <span id="count-${upg.id}">${upg.count}</span></span>
                    &nbsp;&middot;&nbsp;
                    <span>${upg.cps > 0 ? `${upg.cps} CPS each` : `+${upg.cpc} CPC each`}</span>
                `;

                left.appendChild(title);
                left.appendChild(desc);
                left.appendChild(meta);

                const right = document.createElement('div');
                right.className = 'upgrade-actions';

                const costLabel = document.createElement('div');
                costLabel.className = 'muted';
                costLabel.innerHTML = `Cost: <span id="cost-${upg.id}">${formatNumber(costFor(upg))}</span>`;

                const buyBtn = document.createElement('button');
                buyBtn.id = `buy-${upg.id}`;
                buyBtn.textContent = 'Buy';
                buyBtn.addEventListener('click', () => buyUpgrade(upg.id));

                right.appendChild(costLabel);
                right.appendChild(buyBtn);

                container.appendChild(left);
                container.appendChild(right);
                shopEl.appendChild(container);
            });
        }

        function updateUI(state) {
            if (shopEl && shopEl.children.length === 0) {
                buildShop(state);
            }
            scoreEl.textContent = formatNumber(state.cookies);
            cpcEl.textContent = formatNumber(state.cpc);
            cpsEl.textContent = formatNumber(totalCPS(state));

            state.upgrades.forEach(upg => {
                const cost = costFor(upg);
                const costSpan = document.getElementById(`cost-${upg.id}`);
                const countSpan = document.getElementById(`count-${upg.id}`);
                const buyBtn = document.getElementById(`buy-${upg.id}`);

                if (costSpan) costSpan.textContent = formatNumber(cost);
                if (countSpan) countSpan.textContent = upg.count.toString();
                if (buyBtn) buyBtn.disabled = state.cookies < cost;
            });

            updateCursorOrbits(state);
        }

        let lastCursorCount = -1;
        function updateCursorOrbits(state) {
            if (!cursorOrbitsEl) return;
            const cursorUpg = state.upgrades.find(u => u.id === 'cursor');
            const count = cursorUpg ? cursorUpg.count : 0;
            if (count === lastCursorCount) return;
            lastCursorCount = count;

            cursorOrbitsEl.innerHTML = '';
            if (count <= 0) return;

            const radius = Math.round(cookieEl.offsetWidth / 2 + 14);
            const fragment = document.createDocumentFragment();
            const slice = 360 / count;

            for (let i = 0; i < count; i++) {
                const orbit = document.createElement('div');
                orbit.className = 'cursor-orbit';
                orbit.style.setProperty('--start-angle', `${slice * i}deg`);

                const spinner = document.createElement('div');
                spinner.className = 'cursor-spin';
                spinner.style.animationDelay = `${(i * 0.12) % 1.5}s`;

                const triangle = document.createElement('div');
                triangle.className = 'cursor-triangle';
                triangle.style.transform = `translate(-50%, -50%) translateY(-${radius}px) rotate(180deg)`;

                spinner.appendChild(triangle);
                orbit.appendChild(spinner);
                fragment.appendChild(orbit);
            }

            cursorOrbitsEl.appendChild(fragment);
        }

        // ====== Game Logic ======
        let state = load();
        buildShop(state);
        updateUI(state);

        function buyUpgrade(id) {
            const upg = state.upgrades.find(u => u.id === id);
            if (!upg) return;
            const cost = costFor(upg);
            if (state.cookies < cost) return;

            state.cookies -= cost;
            upg.count += 1;

            // Recompute CPC if this upgrade affects clicking
            if (upg.cpc > 0) {
                recomputeCPC(state);
            }

            updateUI(state);
            save(state);
        }

        cookieEl.addEventListener('click', () => {
            state.cookies += state.cpc;
            updateUI(state);
            // Small visual feedback
            cookieEl.style.transform = 'scale(0.96)';
            setTimeout(() => cookieEl.style.transform = '', 80);
            // Save-on-action
            save(state);
        });

        resetButton.addEventListener('click', () => {
            const sure = confirm('Reset all progress? This cannot be undone.');
            if (!sure) return;
            localStorage.removeItem(SAVE_KEY);
            state = newState();
            buildShop(state);
            updateUI(state);
        });

        // Game loop: add CPS over time (smooth)
        let lastTick = performance.now();
        function tick() {
            const now = performance.now();
            const deltaSec = (now - lastTick) / 1000;
            lastTick = now;

            const cps = totalCPS(state);
            if (cps > 0 && deltaSec > 0) {
                state.cookies += cps * deltaSec;
                updateUI(state);
            }
            requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);

        // Autosave every 5 seconds
        setInterval(() => save(state), 5000);
    </script>
</body>

</html>
